@model VlammendVarkenBackend.ViewModels.GerechtViewModel

<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digitaal Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 font-sans">

<div class="w-full max-w-6xl bg-white rounded-xl shadow-lg p-6 md:p-8 space-y-8">

    <!-- Header -->
    <header>
        <h1 class="text-3xl font-bold text-gray-900 text-center">Digitaal Menu</h1>
    </header>

    <!-- Dagmenu -->
    @if (Model != null)
    {
        <section>
            <div class="bg-indigo-50 border border-indigo-200 p-6 rounded-lg shadow-sm">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h3 class="text-xl font-bold text-indigo-800">@Model.Naam</h3>
                        <p class="text-indigo-600 mt-1">@Model.Beschrijving</p>

                        <ul class="mt-2 text-sm text-indigo-700 list-disc list-inside">
                            <li><strong>Bijgerecht:</strong> @(Model.Bijgerecht ?? "-")</li>
                            <li><strong>Groente:</strong> @(Model.Groente ?? "-")</li>
                            <li><strong>Saus:</strong> @(Model.Saus ?? "-")</li>
                        </ul>

                        @if (Model.Allergieen?.Count > 0)
                        {
                            <div class="mt-2 text-sm text-indigo-700">
                                <strong>Allergieën:</strong>
                                @foreach (var emoji in Model.Allergieen)
                                {
                                    <span>@emoji</span>
                                }
                            </div>
                        }
                    </div>
                    <div class="text-right mt-4 md:mt-0 flex-shrink-0 md:ml-6">
                        <p class="text-2xl font-bold text-indigo-800 mb-2">€@Model.Prijs.ToString("0.00")</p>
                        <button id="btnToevoegenDagmenu" class="w-full md:w-auto flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-transform hover:scale-105">
                            <span class="material-icons text-base mr-2">add_shopping_cart</span>
                            Toevoegen
                        </button>
                    </div>
                </div>
            </div>
        </section>
    }
    else
    {
        <p class="text-center text-red-600 font-semibold">Geen dagmenu beschikbaar.</p>
    }

    <!-- Navigatie -->
    <nav class="max-w-md mx-auto bg-white border border-gray-200 rounded-xl shadow-sm p-4 space-y-2">
        <a href="/allergenen" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-indigo-50 group">
            <span class="material-icons text-indigo-600 group-hover:scale-110 transition-transform">medical_information</span>
            <span class="text-gray-800 font-medium group-hover:text-indigo-800">Allergenen Informatie</span>
        </a>
        <a href="/gerechten/voorgerechten" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-indigo-50 group">
            <span class="material-icons text-indigo-600 group-hover:scale-110 transition-transform">restaurant_menu</span>
            <span class="text-gray-800 font-medium group-hover:text-indigo-800">Voorgerechten</span>
        </a>
        <a href="/gerechten/hoofdgerechten/soorten" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-indigo-50 group">
            <span class="material-icons text-indigo-600 group-hover:scale-110 transition-transform">dinner_dining</span>
            <span class="text-gray-800 font-medium group-hover:text-indigo-800">Hoofdgerechten</span>
        </a>
        <a href="/gerechten/nagerechten" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-indigo-50 group">
            <span class="material-icons text-indigo-600 group-hover:scale-110 transition-transform">icecream</span>
            <span class="text-gray-800 font-medium group-hover:text-indigo-800">Nagerechten</span>
        </a>
        <a href="/bestelling/overzicht" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-indigo-50 group">
            <span class="material-icons text-indigo-600 group-hover:scale-110 transition-transform">shopping_cart</span>
            <span class="text-gray-800 font-medium group-hover:text-indigo-800">Besteloverzicht</span>
        </a>
    </nav>


    <!-- Besteloverzicht tabel -->
    <section id="besteloverzicht">
        <div class="overflow-x-auto">
            <table class="min-w-full table-auto border border-gray-200 rounded-lg overflow-hidden">
                <thead class="bg-gray-100 text-sm text-gray-600 uppercase text-left">
                    <tr>
                        <th class="px-4 py-3">Naam</th>
                        <th class="px-4 py-3">Categorie</th>
                        <th class="px-4 py-3">Bijgerecht</th>
                        <th class="px-4 py-3">Groente</th>
                        <th class="px-4 py-3">Saus</th>
                        <th class="px-4 py-3">Allergieën</th>
                        <th class="px-4 py-3 text-right">Actie</th>
                        <th class="px-4 py-3 text-right">Prijs</th>
                    </tr>
                </thead>
                <tbody id="bestellingTabel" class="text-sm text-gray-700 divide-y divide-gray-200">
                </tbody>
                <tfoot class="bg-gray-50 font-bold">
                    <tr class="border-t-2 border-gray-200">
                        <td colspan="7" class="px-4 py-4 text-left">Totaal</td>
                        <td id="totaalPrijs" class="px-4 py-4 text-right">€0.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </section>
</div>

@if (Model != null)
{
    <script>
        let dagmenu = {
            id: @Model.Id,
            naam: "@Model.Naam".trim(),
            prijs: @Model.Prijs.ToString("0.00", System.Globalization.CultureInfo.InvariantCulture),
            categorie: "@Model.Categorie".trim(),
            bijgerecht: "@Model.Bijgerecht",
            groente: "@Model.Groente",
            saus: "@Model.Saus",
            allergieen: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Allergieen ?? new List<string>()))
    };

        let bestelLijst = [];

        function tekenBestelTabel() {
            const tbody = document.getElementById("bestellingTabel");
            tbody.innerHTML = "";
            let totaal = 0;

            bestelLijst.forEach((gerecht, index) => {
                totaal += parseFloat(gerecht.prijs);

                const rij = `
                    <tr>
                        <td class="px-4 py-3 font-semibold">${gerecht.naam}</td>
                        <td class="px-4 py-3">${gerecht.categorie || '-'}</td>
                        <td class="px-4 py-3">${gerecht.bijgerecht || '-'}</td>
                        <td class="px-4 py-3">${gerecht.groente || '-'}</td>
                        <td class="px-4 py-3">${gerecht.saus || '-'}</td>
                        <td class="px-4 py-3">${(gerecht.allergieen || []).join(" ") || '-'}</td>
                        <td class="px-4 py-3 text-right">
                            <button onclick="verwijderGerecht(${index})" class="text-red-500 hover:text-red-700" aria-label="Verwijderen">
                                <span class="material-icons text-base">delete</span>
                            </button>
                        </td>
                        <td class="px-4 py-3 text-right font-semibold">€${parseFloat(gerecht.prijs).toFixed(2)}</td>
                    </tr>
                `;
                tbody.innerHTML += rij;
            });

            document.getElementById("totaalPrijs").textContent = `€${totaal.toFixed(2)}`;
        }

        function verwijderGerecht(index) {
            bestelLijst.splice(index, 1);
            localStorage.setItem("winkelmandje", JSON.stringify(bestelLijst));
            tekenBestelTabel();
        }

        document.addEventListener("DOMContentLoaded", function () {
            const opgeslagen = localStorage.getItem("winkelmandje");
            if (opgeslagen) {
                bestelLijst = JSON.parse(opgeslagen);
                tekenBestelTabel();
            }

            const knop = document.getElementById("btnToevoegenDagmenu");
            if (knop) {
                knop.addEventListener("click", function () {
                    bestelLijst.push(dagmenu);
                    localStorage.setItem("winkelmandje", JSON.stringify(bestelLijst));
                    tekenBestelTabel();

                    // Scroll naar tabel
                    document.getElementById("besteloverzicht").scrollIntoView({ behavior: "smooth" });
                });
            }
        });
    </script>
}
</body>
</html>
